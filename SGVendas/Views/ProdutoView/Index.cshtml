@{
    ViewData["Title"] = "Produtos";
}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Produtos</h2>

        
        <a href="/ProdutoView/Novo" class="btn btn-primary">

            <i class="bi bi-plus-circle"></i> Novo Produto
        </a>
    </div>

    <!-- Campo de busca -->
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="text"
                   id="txtBusca"
                   class="form-control"
                   placeholder="Buscar produto..."
                   onkeyup="buscarProdutos()" />
        </div>
    </div>

    <!-- Tabela -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Código</th>
                <th>Produto</th>
                <th>Preço</th>
                <th>Estoque</th>
            </tr>
        </thead>
        <tbody id="tbodyProdutos">
            <tr>
                <td colspan="4" class="text-center text-muted">
                    Carregando produtos...
                </td>
            </tr>
        </tbody>
    </table>

</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            carregarProdutos();
        });

        function carregarProdutos() {
            fetch('/api/produtos')
                .then(response => {
                    if (!response.ok)
                        throw new Error('Erro ao carregar produtos');
                    return response.json();
                })
                .then(data => montarTabela(data))
                .catch(err => {
                    console.error(err);
                    document.getElementById('tbodyProdutos').innerHTML = `
                        <tr>
                            <td colspan="4" class="text-danger text-center">
                                Erro ao carregar produtos
                            </td>
                        </tr>`;
                });
        }

        // 🧱 MONTA A TABELA (PADRÃO API /api/produtos)
        function montarTabela(produtos) {
            const tbody = document.getElementById('tbodyProdutos');
            tbody.innerHTML = '';

            if (!produtos || produtos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted">
                            Nenhum produto encontrado
                        </td>
                    </tr>`;
                return;
            }

            produtos.forEach(p => {
                tbody.innerHTML += `
                    <tr>
                        <td>${p.produtoID}</td>
                        <td>${p.nomeProduto}</td>
                        <td>R$ ${p.precoDeVenda.toFixed(2)}</td>
                        <td>${p.estoque}</td>
                    </tr>`;
            });
        }
    </script>
}


